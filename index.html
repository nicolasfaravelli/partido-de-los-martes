<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Partido de los Martes</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ==========================================
            1. AJUSTES ESTTICOS (Variables)
            ========================================== */
        :root {
            --color-acento: #75AADB; 
            --color-acento-off: #3d4e5f;          
            --color-fondo: #0f0f0f; 
            --color-paneles: #1a1a1a; 
            --color-bordes: #333333;
            --fuente-impacto: 'Bebas Neue', sans-serif;
            --fuente-datos: 'Montserrat', sans-serif;

            --url-pizarra: url('https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Fondo%20armador.png');
            --blur-fondo-modal: blur(10px);        
            --opacidad-boton-bloqueado: 0.8;      
            --escala-hover-equipo: 1.025;         
            --brillo-celeste-cuadro: 0 0 100px rgba(24, 60, 93, 0.4); 
            --gloss-claro: inset 0 0 80px rgba(0,0,0,0.2);
            --gloss-oscuro: inset 0 0 80px rgba(255,255,255,0.1);

            /* VELOCIDADES EDITABLES */
            --velocidad-brillo: 0.7s; 
            --velocidad-botones: 0.1s;
        }

        body { background-color: var(--color-fondo); color: #fff; font-family: var(--fuente-datos); margin: 0; padding: 0 20px 20px 20px; background-image: var(--fondo-url); background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed; user-select: none; }
        body.modal-open { overflow: hidden; }
        #version-tag { position: fixed; bottom: 10px; left: 15px; font-size: 0.7rem; color: #444; z-index: 5000; font-weight: bold; }

        /* HEADER */
        .header-container { text-align: center; position: sticky; top: 0; z-index: 100; margin: 0 -20px 10px -20px; padding: 20px 0; }
        .header-container::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: var(--color-fondo); background-image: var(--fondo-url); background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed; opacity: 0.95; box-shadow: 0 10px 20px rgba(0,0,0,0.5); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .title-img { max-width: 85%; height: auto; max-height: 120px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); }

        .controls-area { max-width: 1200px; margin: 0 auto 20px; display: flex; gap: 15px; flex-wrap: wrap; background: rgba(20, 20, 20, 0.95); padding: 15px; border-radius: 8px; border: 1px solid var(--color-bordes); justify-content: space-between; align-items: center; position: relative; z-index: 50; }
        
        #search-input, #sort-select, .controls-area .btn { height: 45px; box-sizing: border-box; margin: 0; display: flex; align-items: center; }
        #search-input, #sort-select { flex: 1; padding: 0 15px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 4px; min-width: 150px; outline: none; font-family: var(--fuente-datos); }
        #search-input:focus, #sort-select:focus { border-color: var(--color-acento); }

        /* GRID CARTAS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; }
        .card { position: relative; width: 100%; aspect-ratio: 2 / 3; cursor: pointer; transition: transform 0.2s; container-type: size; outline: none; -webkit-tap-highlight-color: transparent; }
        .card:hover { transform: scale(1.05); z-index: 10; }
        .card-bg-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; filter: drop-shadow(0 5px 6px rgba(0,0,0,0.6)); }
        .card-bg { width: 100%; height: 100%; object-fit: contain; }
        .card-face { position: absolute; z-index: 2; top: 9.75%; left: 5.25%; width: 95%; object-fit: contain; }
        .info-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; pointer-events: none; }
        .rating { font-family: var(--fuente-impacto); position: absolute; top: 13.5%; left: 6%; font-size: 18cqw; text-align: center; width: 25%; line-height: 0.8; }
        .position { font-family: var(--fuente-impacto); position: absolute; top: 24%; left: 6%; font-size: 10cqw; text-align: center; width: 25%; }
        .name { font-family: var(--fuente-impacto); position: absolute; top: 64.25%; left: 5%; width: 90%; text-align: center; font-size: 14.5cqw; text-transform: uppercase; }
        .stats-container { display: flex; justify-content: space-between; position: absolute; top: 81%; left: 8%; width: 84.1%; }
        .stat-val { font-family: var(--fuente-impacto); font-size: 8.5cqw; display: block; text-align: center; width: 16%; }

        /* EFECTO DE BRILLO DIAGONAL DEFINITIVO */
        .shine-layer::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 250%; 
            height: 250%; 
            background: linear-gradient(
                135deg, 
                rgba(255,255,255,0) 42%, 
                rgba(255,255,255,0.8) 50%, 
                rgba(255,255,255,0) 58%
            );
            pointer-events: none;
            opacity: 0;
            z-index: 6;
            transform: translate(-100%, -100%); /* Escondido arriba a la izquierda */
        }

        /* Disparadores Animaci贸n */
        .card:hover .shine-layer::after, .ani-brillo-ida::after {
            animation: brillo-diagonal-ida var(--velocidad-brillo) ease-in-out forwards;
        }
        .ani-brillo-vuelta::after {
            animation: brillo-diagonal-vuelta var(--velocidad-brillo) ease-in-out forwards;
        }

        @keyframes brillo-diagonal-ida {
            0% { transform: translate(-100%, -100%); opacity: 1; }
            100% { transform: translate(50%, 50%); opacity: 1; }
        }

        @keyframes brillo-diagonal-vuelta {
            0% { transform: translate(50%, 50%); opacity: 1; }
            100% { transform: translate(-100%, -100%); opacity: 1; }
        }

        /* ARMADOR */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: var(--blur-fondo-modal); }
        #modal-card-container { width: 340px; aspect-ratio: 2 / 3; margin-bottom: 20px; display: flex; justify-content: center; }
        #team-modal-content { background: var(--color-paneles); background-image: var(--url-pizarra); background-size: cover; background-position: center; padding: 20px; border-radius: 8px; border: 1px solid var(--color-bordes); width: 95%; max-width: 950px; max-height: 95vh; display: flex; flex-direction: column; box-shadow: var(--brillo-celeste-cuadro); }
        .armador-layout { overflow-y: auto; overflow-x: hidden; flex: 1; padding: 0 10px; }

        .players-list-scroll { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; max-height: 200px; overflow-y: auto; }
        .player-row { display: flex; align-items: center; gap: 10px; padding: 8px; background: #252525; border-radius: 4px; cursor: pointer; font-family: var(--fuente-datos); font-weight: bold; border: 1px solid transparent; box-sizing: border-box; }
        .player-row.selected { border-color: var(--color-acento); color: var(--color-acento); }
        .player-row input[type="checkbox"] { accent-color: var(--color-acento); }

        .teams-container { display: grid; grid-template-columns: 1fr 300px 1fr; gap: 15px; margin-top: 10px; min-height: 250px; width: 100%; padding: 15px 0; align-items: start; }
        .team-box { padding: 10px; border-radius: 6px; border: 2px solid #333; display: flex; flex-direction: column; transition: transform 0.2s ease; height: 100%; box-sizing: border-box; }
        .team-box.highlight { transform: scale(var(--escala-hover-equipo)); z-index: 5; border-color: var(--color-acento); }
        .team-white { background: #ffffff; color: #111; border-color: #ccc; box-shadow: var(--gloss-claro); }
        .team-black { background: #000000; color: #ffffff; border-color: #333; box-shadow: var(--gloss-oscuro); }
        .team-header { font-size: 1.8rem; font-family: var(--fuente-impacto); text-align: center; border-bottom: 2px solid; font-weight: bold; margin-bottom: 5px; }
        .team-avg-label { text-align: center; font-family: var(--fuente-impacto); font-size: 1.1rem; letter-spacing: 1px; padding: 4px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .team-player-li { padding: 8px 10px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 1.1rem; font-family: var(--fuente-datos); font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        /* RADAR */
        #radar-container { background: var(--color-acento); border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; height: 280px; position: relative; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        canvas#radarChart { width: 100% !important; height: 100% !important; }

        @media (max-width: 900px) {
            .teams-container { grid-template-columns: 1fr 1fr; gap: 8px; }
            #radar-container { grid-column: span 2; order: 3; height: 240px; margin-top: 10px; }
            .team-header { font-size: 1.2rem; }
            .team-avg-label { font-size: 0.85rem; }
            .team-player-li { font-size: 0.95rem; padding: 5px 6px; }
        }

        /* BOTONES */
        .btn-group { display: flex; flex-direction: row; gap: 10px; justify-content: center; width: 100%; flex-wrap: wrap; margin-top: 10px; }
        .btn { border: 1px solid transparent; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-family: var(--fuente-datos); font-weight: 900; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; justify-content: center; transition: all var(--velocidad-botones) ease; letter-spacing: 0.8px; text-transform: uppercase; }
        .btn-gold { background: var(--color-acento); color: #fff; }
        .btn-gold:hover:not(:disabled) { box-shadow: 0 0 15px var(--color-acento); background: #8bb7e2; }
        #btn-generate:disabled { background-color: var(--color-acento-off) !important; color: #8899aa !important; cursor: not-allowed; }
        .btn-ghost { background: rgba(42, 42, 42, 0.9); color: #fff; border: 1px solid #444; }
        .btn-add-guest { background: #111; border: 1px solid #444; color: #eee; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }

        .modal-footer { display: flex; flex-direction: row; justify-content: flex-end; gap: 15px; padding-top: 15px; width: 100%; }

        .shine-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; overflow: hidden; mask-size: contain; mask-repeat: no-repeat; -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; pointer-events: none; }
        #loader { text-align: center; color: #666; margin-top: 50px; font-family: var(--fuente-impacto); letter-spacing: 2px; }
        #music-control { position:fixed; bottom:20px; right:20px; font-size:2rem; cursor:pointer; z-index:4000; width:45px; display: flex; align-items: center; }
    </style>
</head>

<body>
    <div id="version-tag">v. 15.4 (Final Shine Fix)</div>
    <div class="header-container" id="header-area"></div>
    
    <div class="controls-area">
        <input type="text" id="search-input" placeholder="BUSCAR JUGADOR...">
        <select id="sort-select">
            <option value="nombre-asc">Nombre: A - Z</option>
            <option value="nombre-desc">Nombre: Z - A</option>
            <option value="prom-desc">Valoraci贸n: mayor a menor</option>
            <option value="prom-asc">Valoraci贸n: menor a mayor</option>
        </select>
        <button class="btn btn-gold" onclick="abrirArmador()">Armar Equipos</button>
    </div>

    <div id="loader">CARGANDO JUGADORES...</div>
    <div id="grid-container" class="grid"></div>

    <div id="modal" class="modal-overlay">
        <div id="modal-card-container"></div>
        <div class="btn-group" id="modal-buttons"></div>
    </div>

    <div id="team-modal" class="modal-overlay">
        <div id="team-modal-content">
            <div class="team-title" style="text-align:center; color:var(--color-acento); font-size:2.2rem; font-family:var(--fuente-impacto); letter-spacing:2px; margin-bottom:10px;">ARMADOR DE EQUIPOS</div>
            <div class="armador-layout">
                <div class="selection-area" style="background:rgba(0,0,0,0.4); padding:10px; border-radius:6px; margin-bottom:10px; border:1px solid rgba(255,255,255,0.1);">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span id="team-counter" style="font-weight:bold; color:#ccc; font-size:0.9rem;">SELECCIONADOS: 0 / 10</span>
                        <button class="btn-add-guest" id="btn-add-guest" onclick="agregarInvitado()">+ AGREGAR INVITADO</button>
                    </div>
                    <div id="players-checklist" class="players-list-scroll"></div>
                </div>
                
                <div style="display: flex; justify-content: center; width: 100%; margin: 15px 0;">
                    <button class="btn btn-gold" style="padding: 10px 30px;" onclick="generarAutomatico()" id="btn-generate">Generar autom谩tico</button>
                </div>

                <div id="team-capture-area">
                    <div class="teams-container" id="main-teams-layout">
                        <div class="team-box team-white" id="box-team-1" onmouseenter="highlightTeam(0)" onmouseleave="highlightTeam(-1)" onclick="highlightTeam(0)">
                            <div class="team-header">CLARO</div>
                            <div id="avg-team-1" class="team-avg-label">PROM: 0</div>
                            <ul class="team-list-ul" id="list-team-1" style="list-style:none; padding:0; margin:0;"></ul>
                        </div>
                        <div id="radar-container">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div class="team-box team-black" id="box-team-2" onmouseenter="highlightTeam(1)" onmouseleave="highlightTeam(-1)" onclick="highlightTeam(1)">
                            <div class="team-header">OSCURO</div>
                            <div id="avg-team-2" class="team-avg-label">PROM: 0</div>
                            <ul class="team-list-ul" id="list-team-2" style="list-style:none; padding:0; margin:0;"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-gold" onclick="compartirEquipos()" id="btn-share-teams" style="display:none; margin-right:auto;">Compartir</button>
                <button class="btn btn-ghost" onclick="cerrarArmador()">Cerrar</button>
            </div>
        </div>
    </div>

    <audio id="audio-player" loop></audio>
    <audio id="sfx-hover-player"></audio>
    <audio id="sfx-click-player"></audio>
    <div id="music-control" onclick="rotateMusic()"></div>

<script>
    const CONFIG = {
        MULT_LEYENDA: [1.13, 1.11, 1.09, 1.07, 1.05, 1.03],
        PLUS_EDAD_COEF: 0.0028,
        BONUS_RESISTENCIA: 1.05,
        BONUS_VELOCIDAD: 1.03,
        TOPE_STAT_LEYENDA: 98,
        URL_FONDO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Fondo.png",
        URL_TITULO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Titulo.png",
        URL_MUSICA: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Musica.mp3",
        URL_LEYENDA_FONDO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/LEYENDA.png",
        URL_SFX_HOVER: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Click 1.mp3",
        URL_SFX_CLICK: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Click 2.mp3",
        URL_CSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTHOyW-OmPwPBpIwBw30sBjYdcLn1_8xFjkXfG9_tLFeB960jfYnnouTDieGPeKSK49FYM1tSGng_mg/pub?gid=1826229647&single=true&output=csv",
        VOL_SERIES: [0.05, 0.2, 0],
        SFX_MAP: { 0: 0, 0.05: 0.0375, 0.2: 0.15 }
    };

    const COLORES = { 'leyenda': '#644b14', 'legendario': '#372864', 'oro': '#624f21', 'plata': '#434343', 'bronce': '#5e3e21' };
    const STAT_COLORS = { 'legend': '#a855f7', 'gold': '#d4af37', 'silver': '#7a7a7a', 'bronze': '#5e3e21' };
    const ICON_SERIES = ["", "", ""];

    let datosOriginales = [], invitados = [], equipo1 = [], equipo2 = [];
    let jugadorActualEnModal = null, esModoLeyenda = false, volIndex = 0, teamRadarChart = null;

    document.addEventListener("DOMContentLoaded", () => {
        if(CONFIG.URL_FONDO) document.documentElement.style.setProperty('--fondo-url', `url('${CONFIG.URL_FONDO}')`);
        if(CONFIG.URL_TITULO) document.getElementById('header-area').innerHTML = `<img src="${CONFIG.URL_TITULO}" class="title-img">`;
        document.getElementById('search-input').addEventListener('input', aplicarFiltrosYOrden);
        document.getElementById('sort-select').addEventListener('change', aplicarFiltrosYOrden);
        window.addEventListener('click', initAudio, {once:true});
        window.addEventListener('touchstart',<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Partido de los Martes</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ==========================================
            1. AJUSTES ESTTICOS (Variables)
            ========================================== */
        :root {
            --color-acento: #75AADB; 
            --color-acento-off: #3d4e5f;          
            --color-fondo: #0f0f0f; 
            --color-paneles: #1a1a1a; 
            --color-bordes: #333333;
            --fuente-impacto: 'Bebas Neue', sans-serif;
            --fuente-datos: 'Montserrat', sans-serif;

            --url-pizarra: url('https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Fondo%20armador.png');
            --blur-fondo-modal: blur(10px);        
            --opacidad-boton-bloqueado: 0.8;      
            --escala-hover-equipo: 1.025;         
            --brillo-celeste-cuadro: 0 0 100px rgba(24, 60, 93, 0.4); 
            --gloss-claro: inset 0 0 80px rgba(0,0,0,0.2);
            --gloss-oscuro: inset 0 0 80px rgba(255,255,255,0.1);

            /* VELOCIDADES EDITABLES */
            --velocidad-brillo: 0.7s; 
            --velocidad-botones: 0.1s;
        }

        body { background-color: var(--color-fondo); color: #fff; font-family: var(--fuente-datos); margin: 0; padding: 0 20px 20px 20px; background-image: var(--fondo-url); background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed; user-select: none; }
        body.modal-open { overflow: hidden; }
        #version-tag { position: fixed; bottom: 10px; left: 15px; font-size: 0.7rem; color: #444; z-index: 5000; font-weight: bold; }

        /* HEADER */
        .header-container { text-align: center; position: sticky; top: 0; z-index: 100; margin: 0 -20px 10px -20px; padding: 20px 0; }
        .header-container::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: var(--color-fondo); background-image: var(--fondo-url); background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed; opacity: 0.95; box-shadow: 0 10px 20px rgba(0,0,0,0.5); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .title-img { max-width: 85%; height: auto; max-height: 120px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); }

        .controls-area { max-width: 1200px; margin: 0 auto 20px; display: flex; gap: 15px; flex-wrap: wrap; background: rgba(20, 20, 20, 0.95); padding: 15px; border-radius: 8px; border: 1px solid var(--color-bordes); justify-content: space-between; align-items: center; position: relative; z-index: 50; }
        
        #search-input, #sort-select, .controls-area .btn { height: 45px; box-sizing: border-box; margin: 0; display: flex; align-items: center; }
        #search-input, #sort-select { flex: 1; padding: 0 15px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 4px; min-width: 150px; outline: none; font-family: var(--fuente-datos); }
        #search-input:focus, #sort-select:focus { border-color: var(--color-acento); }

        /* GRID CARTAS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; }
        .card { position: relative; width: 100%; aspect-ratio: 2 / 3; cursor: pointer; transition: transform 0.2s; container-type: size; outline: none; -webkit-tap-highlight-color: transparent; }
        .card:hover { transform: scale(1.05); z-index: 10; }
        .card-bg-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; filter: drop-shadow(0 5px 6px rgba(0,0,0,0.6)); }
        .card-bg { width: 100%; height: 100%; object-fit: contain; }
        .card-face { position: absolute; z-index: 2; top: 9.75%; left: 5.25%; width: 95%; object-fit: contain; }
        .info-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; pointer-events: none; }
        .rating { font-family: var(--fuente-impacto); position: absolute; top: 13.5%; left: 6%; font-size: 18cqw; text-align: center; width: 25%; line-height: 0.8; }
        .position { font-family: var(--fuente-impacto); position: absolute; top: 24%; left: 6%; font-size: 10cqw; text-align: center; width: 25%; }
        .name { font-family: var(--fuente-impacto); position: absolute; top: 64.25%; left: 5%; width: 90%; text-align: center; font-size: 14.5cqw; text-transform: uppercase; }
        .stats-container { display: flex; justify-content: space-between; position: absolute; top: 81%; left: 8%; width: 84.1%; }
        .stat-val { font-family: var(--fuente-impacto); font-size: 8.5cqw; display: block; text-align: center; width: 16%; }

        /* EFECTO DE BRILLO DIAGONAL DEFINITIVO */
        .shine-layer::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 250%; 
            height: 250%; 
            background: linear-gradient(
                135deg, 
                rgba(255,255,255,0) 42%, 
                rgba(255,255,255,0.8) 50%, 
                rgba(255,255,255,0) 58%
            );
            pointer-events: none;
            opacity: 0;
            z-index: 6;
            transform: translate(-100%, -100%); /* Escondido arriba a la izquierda */
        }

        /* Disparadores Animaci贸n */
        .card:hover .shine-layer::after, .ani-brillo-ida::after {
            animation: brillo-diagonal-ida var(--velocidad-brillo) ease-in-out forwards;
        }
        .ani-brillo-vuelta::after {
            animation: brillo-diagonal-vuelta var(--velocidad-brillo) ease-in-out forwards;
        }

        @keyframes brillo-diagonal-ida {
            0% { transform: translate(-100%, -100%); opacity: 1; }
            100% { transform: translate(50%, 50%); opacity: 1; }
        }

        @keyframes brillo-diagonal-vuelta {
            0% { transform: translate(50%, 50%); opacity: 1; }
            100% { transform: translate(-100%, -100%); opacity: 1; }
        }

        /* ARMADOR */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: var(--blur-fondo-modal); }
        #modal-card-container { width: 340px; aspect-ratio: 2 / 3; margin-bottom: 20px; display: flex; justify-content: center; }
        #team-modal-content { background: var(--color-paneles); background-image: var(--url-pizarra); background-size: cover; background-position: center; padding: 20px; border-radius: 8px; border: 1px solid var(--color-bordes); width: 95%; max-width: 950px; max-height: 95vh; display: flex; flex-direction: column; box-shadow: var(--brillo-celeste-cuadro); }
        .armador-layout { overflow-y: auto; overflow-x: hidden; flex: 1; padding: 0 10px; }

        .players-list-scroll { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; max-height: 200px; overflow-y: auto; }
        .player-row { display: flex; align-items: center; gap: 10px; padding: 8px; background: #252525; border-radius: 4px; cursor: pointer; font-family: var(--fuente-datos); font-weight: bold; border: 1px solid transparent; box-sizing: border-box; }
        .player-row.selected { border-color: var(--color-acento); color: var(--color-acento); }
        .player-row input[type="checkbox"] { accent-color: var(--color-acento); }

        .teams-container { display: grid; grid-template-columns: 1fr 300px 1fr; gap: 15px; margin-top: 10px; min-height: 250px; width: 100%; padding: 15px 0; align-items: start; }
        .team-box { padding: 10px; border-radius: 6px; border: 2px solid #333; display: flex; flex-direction: column; transition: transform 0.2s ease; height: 100%; box-sizing: border-box; }
        .team-box.highlight { transform: scale(var(--escala-hover-equipo)); z-index: 5; border-color: var(--color-acento); }
        .team-white { background: #ffffff; color: #111; border-color: #ccc; box-shadow: var(--gloss-claro); }
        .team-black { background: #000000; color: #ffffff; border-color: #333; box-shadow: var(--gloss-oscuro); }
        .team-header { font-size: 1.8rem; font-family: var(--fuente-impacto); text-align: center; border-bottom: 2px solid; font-weight: bold; margin-bottom: 5px; }
        .team-avg-label { text-align: center; font-family: var(--fuente-impacto); font-size: 1.1rem; letter-spacing: 1px; padding: 4px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .team-player-li { padding: 8px 10px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 1.1rem; font-family: var(--fuente-datos); font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        /* RADAR */
        #radar-container { background: var(--color-acento); border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; height: 280px; position: relative; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        canvas#radarChart { width: 100% !important; height: 100% !important; }

        @media (max-width: 900px) {
            .teams-container { grid-template-columns: 1fr 1fr; gap: 8px; }
            #radar-container { grid-column: span 2; order: 3; height: 240px; margin-top: 10px; }
            .team-header { font-size: 1.2rem; }
            .team-avg-label { font-size: 0.85rem; }
            .team-player-li { font-size: 0.95rem; padding: 5px 6px; }
        }

        /* BOTONES */
        .btn-group { display: flex; flex-direction: row; gap: 10px; justify-content: center; width: 100%; flex-wrap: wrap; margin-top: 10px; }
        .btn { border: 1px solid transparent; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-family: var(--fuente-datos); font-weight: 900; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; justify-content: center; transition: all var(--velocidad-botones) ease; letter-spacing: 0.8px; text-transform: uppercase; }
        .btn-gold { background: var(--color-acento); color: #fff; }
        .btn-gold:hover:not(:disabled) { box-shadow: 0 0 15px var(--color-acento); background: #8bb7e2; }
        #btn-generate:disabled { background-color: var(--color-acento-off) !important; color: #8899aa !important; cursor: not-allowed; }
        .btn-ghost { background: rgba(42, 42, 42, 0.9); color: #fff; border: 1px solid #444; }
        .btn-add-guest { background: #111; border: 1px solid #444; color: #eee; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }

        .modal-footer { display: flex; flex-direction: row; justify-content: flex-end; gap: 15px; padding-top: 15px; width: 100%; }

        .shine-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; overflow: hidden; mask-size: contain; mask-repeat: no-repeat; -webkit-mask-size: contain; -webkit-mask-repeat: no-repeat; pointer-events: none; }
        #loader { text-align: center; color: #666; margin-top: 50px; font-family: var(--fuente-impacto); letter-spacing: 2px; }
        #music-control { position:fixed; bottom:20px; right:20px; font-size:2rem; cursor:pointer; z-index:4000; width:45px; display: flex; align-items: center; }
    </style>
</head>

<body>
    <div id="version-tag">v. 2</div>
    <div class="header-container" id="header-area"></div>
    
    <div class="controls-area">
        <input type="text" id="search-input" placeholder="BUSCAR JUGADOR...">
        <select id="sort-select">
            <option value="nombre-asc">Nombre: A - Z</option>
            <option value="nombre-desc">Nombre: Z - A</option>
            <option value="prom-desc">Valoraci贸n: mayor a menor</option>
            <option value="prom-asc">Valoraci贸n: menor a mayor</option>
        </select>
        <button class="btn btn-gold" onclick="abrirArmador()">Armar Equipos</button>
    </div>

    <div id="loader">CARGANDO JUGADORES...</div>
    <div id="grid-container" class="grid"></div>

    <div id="modal" class="modal-overlay">
        <div id="modal-card-container"></div>
        <div class="btn-group" id="modal-buttons"></div>
    </div>

    <div id="team-modal" class="modal-overlay">
        <div id="team-modal-content">
            <div class="team-title" style="text-align:center; color:var(--color-acento); font-size:2.2rem; font-family:var(--fuente-impacto); letter-spacing:2px; margin-bottom:10px;">ARMADOR DE EQUIPOS</div>
            <div class="armador-layout">
                <div class="selection-area" style="background:rgba(0,0,0,0.4); padding:10px; border-radius:6px; margin-bottom:10px; border:1px solid rgba(255,255,255,0.1);">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span id="team-counter" style="font-weight:bold; color:#ccc; font-size:0.9rem;">SELECCIONADOS: 0 / 10</span>
                        <button class="btn-add-guest" id="btn-add-guest" onclick="agregarInvitado()">+ AGREGAR INVITADO</button>
                    </div>
                    <div id="players-checklist" class="players-list-scroll"></div>
                </div>
                
                <div style="display: flex; justify-content: center; width: 100%; margin: 15px 0;">
                    <button class="btn btn-gold" style="padding: 10px 30px;" onclick="generarAutomatico()" id="btn-generate">Generar autom谩tico</button>
                </div>

                <div id="team-capture-area">
                    <div class="teams-container" id="main-teams-layout">
                        <div class="team-box team-white" id="box-team-1" onmouseenter="highlightTeam(0)" onmouseleave="highlightTeam(-1)" onclick="highlightTeam(0)">
                            <div class="team-header">CLARO</div>
                            <div id="avg-team-1" class="team-avg-label">PROM: 0</div>
                            <ul class="team-list-ul" id="list-team-1" style="list-style:none; padding:0; margin:0;"></ul>
                        </div>
                        <div id="radar-container">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div class="team-box team-black" id="box-team-2" onmouseenter="highlightTeam(1)" onmouseleave="highlightTeam(-1)" onclick="highlightTeam(1)">
                            <div class="team-header">OSCURO</div>
                            <div id="avg-team-2" class="team-avg-label">PROM: 0</div>
                            <ul class="team-list-ul" id="list-team-2" style="list-style:none; padding:0; margin:0;"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-gold" onclick="compartirEquipos()" id="btn-share-teams" style="display:none; margin-right:auto;">Compartir</button>
                <button class="btn btn-ghost" onclick="cerrarArmador()">Cerrar</button>
            </div>
        </div>
    </div>

    <audio id="audio-player" loop></audio>
    <audio id="sfx-hover-player"></audio>
    <audio id="sfx-click-player"></audio>
    <div id="music-control" onclick="rotateMusic()"></div>

<script>
    const CONFIG = {
        MULT_LEYENDA: [1.13, 1.11, 1.09, 1.07, 1.05, 1.03],
        PLUS_EDAD_COEF: 0.0028,
        BONUS_RESISTENCIA: 1.05,
        BONUS_VELOCIDAD: 1.03,
        TOPE_STAT_LEYENDA: 98,
        URL_FONDO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Fondo.png",
        URL_TITULO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Titulo.png",
        URL_MUSICA: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Musica.mp3",
        URL_LEYENDA_FONDO: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/LEYENDA.png",
        URL_SFX_HOVER: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Click 1.mp3",
        URL_SFX_CLICK: "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Click 2.mp3",
        URL_CSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTHOyW-OmPwPBpIwBw30sBjYdcLn1_8xFjkXfG9_tLFeB960jfYnnouTDieGPeKSK49FYM1tSGng_mg/pub?gid=1826229647&single=true&output=csv",
        VOL_SERIES: [0.05, 0.2, 0],
        SFX_MAP: { 0: 0, 0.05: 0.0375, 0.2: 0.15 }
    };

    const COLORES = { 'leyenda': '#644b14', 'legendario': '#372864', 'oro': '#624f21', 'plata': '#434343', 'bronce': '#5e3e21' };
    const STAT_COLORS = { 'legend': '#a855f7', 'gold': '#d4af37', 'silver': '#7a7a7a', 'bronze': '#5e3e21' };
    const ICON_SERIES = ["", "", ""];

    let datosOriginales = [], invitados = [], equipo1 = [], equipo2 = [];
    let jugadorActualEnModal = null, esModoLeyenda = false, volIndex = 0, teamRadarChart = null;

    document.addEventListener("DOMContentLoaded", () => {
        if(CONFIG.URL_FONDO) document.documentElement.style.setProperty('--fondo-url', `url('${CONFIG.URL_FONDO}')`);
        if(CONFIG.URL_TITULO) document.getElementById('header-area').innerHTML = `<img src="${CONFIG.URL_TITULO}" class="title-img">`;
        document.getElementById('search-input').addEventListener('input', aplicarFiltrosYOrden);
        document.getElementById('sort-select').addEventListener('change', aplicarFiltrosYOrden);
        window.addEventListener('click', initAudio, {once:true});
        window.addEventListener('touchstart',
