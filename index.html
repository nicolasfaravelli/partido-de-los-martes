<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Partido de los Martes</title>
    <meta name="description" content="Plantel oficial">
    <meta property="og:title" content="Partido de los Martes">
    <meta property="og:description" content="Plantel Oficial">
    <meta property="og:type" content="website">

    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        /* =========================================
           1. ESTILOS GENERALES Y FONDO
           ========================================= */
        :root {
            --fondo-url: none;
            /* PALETA */
            --color-fondo: #0f0f0f;
            --color-paneles: #1a1a1a;
            --color-bordes: #333333;
            --color-texto: #ffffff;
            --color-acento: #d4af37; /* Dorado */
            
            /* Colores de Stats */
            --stat-legend: #a855f7;
            --stat-gold: #d4af37;
            --stat-silver: #c0c0c0;
            --stat-bronze: #cd7f32;

            /* TIPOGRAF√çAS */
            --fuente-titulo: 'Bebas Neue', sans-serif;
            --fuente-texto: system-ui, -apple-system, sans-serif;
        }

        body { 
            background-color: var(--color-fondo); 
            color: var(--color-texto); 
            font-family: var(--fuente-titulo); 
            margin: 0; 
            padding: 0 20px 20px 20px; 
            background-image: var(--fondo-url); 
            background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed;
            transition: filter 0.3s;
        }

        /* =========================================
           2. ENCABEZADO
           ========================================= */
        .header-container { 
            text-align: center; position: sticky; top: 0; z-index: 100;
            margin: 0 -20px 10px -20px; padding: 20px 0 20px 0;
        }
        
        .header-container::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
            background-color: var(--color-fondo); 
            background-image: var(--fondo-url); 
            background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed;
            opacity: 0.95; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        h1 { margin: 0; letter-spacing: 2px; font-size: 2.5rem; color: var(--color-acento); }
        
        .title-img { 
            max-width: 85%; height: auto; max-height: 120px; 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); 
            transition: transform 0.1s; cursor: pointer; -webkit-tap-highlight-color: transparent; 
        }
        .title-img:active { transform: scale(0.98); }

        /* =========================================
           3. CONTROLES
           ========================================= */
        .controls-area {
            max-width: 1200px; margin: 0 auto 20px auto; 
            display: flex; gap: 10px; flex-wrap: wrap;
            background: rgba(20, 20, 20, 0.95); 
            padding: 15px; border-radius: 8px; border: 1px solid var(--color-bordes); 
            justify-content: space-between; align-items: center; 
            position: relative; z-index: 50;
        }

        #search-input, #sort-select {
            flex: 1; padding: 10px 15px; 
            font-family: var(--fuente-titulo); font-size: 1.1rem; letter-spacing: 1px;
            background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 4px; 
            min-width: 150px;
        }
        #search-input:focus, #sort-select:focus { outline: none; border-color: var(--color-acento); }

        /* Bot√≥n Est√°ndar (Gris) */
        .btn-standard {
            background: #333; color: white; border: 1px solid #555; 
            padding: 10px 20px; border-radius: 4px; cursor: pointer;
            font-family: var(--fuente-titulo); font-size: 1.2rem; letter-spacing: 1px;
            display: flex; align-items: center; gap: 8px; justify-content: center;
            transition: all 0.2s;
        }
        .btn-standard:hover { background: #444; border-color: var(--color-acento); }

        /* =========================================
           4. GRILLA Y CARTA
           ========================================= */
        .grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 20px; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; 
        }
        
        .card { 
            position: relative; width: 100%; aspect-ratio: 2 / 3; 
            background: transparent; cursor: pointer; 
            transition: transform 0.2s ease-out; container-type: size; transform: translateZ(0); 
            -webkit-tap-highlight-color: transparent; 
        }
        .card:hover { transform: scale(1.05); z-index: 10; }

        .card-bg-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; display: block; filter: drop-shadow(0 5px 6px rgba(0,0,0,0.6)); z-index: 1; }
        .card-bg { width: 100%; height: 100%; object-fit: contain; display: block; image-rendering: auto; transform: translateZ(0); backface-visibility: hidden; will-change: transform; }
        .card-face { position: absolute; z-index: 2; top: 9.75%; left: 5.25%; width: 95%; object-fit: contain; display: block; }
        .info-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; pointer-events: none; }
        
        /* Brillo */
        .shine-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; pointer-events: none; overflow: hidden; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; }
        .shine-layer::after { content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%); transform: skewX(-25deg); transition: none; }
        .card:hover .shine-layer::after { left: 150%; transition: left 0.6s; }

        /* Textos Carta */
        .rating { position: absolute; top: 13.5%; left: 6%; font-size: 18cqw; text-align: center; width: 25%; line-height: 0.8; }
        .position { position: absolute; top: 24%; left: 6%; font-size: 10cqw; text-align: center; width: 25%; line-height: 1; }
        .name { position: absolute; top: 64.25%; left: 5%; width: 90%; text-align: center; font-size: 14.5cqw; text-transform: uppercase; letter-spacing: 1px; }
        .stats-container { display: flex; justify-content: space-between; position: absolute; top: 81%; left: 8%; width: 84.1%; }
        .stat-box { text-align: center; width: 16%; }
        .stat-val { font-size: 8.5cqw; display: block; }

        /* =========================================
           5. M√öSICA
           ========================================= */
        .music-btn { 
            position: fixed; bottom: 20px; right: 20px; z-index: 2000; 
            width: 50px; height: 50px; background: rgba(0, 0, 0, 0.8); 
            border: 2px solid #444; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
            transition: all 0.2s; -webkit-tap-highlight-color: transparent; 
        }
        .music-btn:hover { transform: scale(1.1); border-color: var(--color-acento); }
        .music-btn.playing { border-color: var(--color-acento); color: var(--color-acento); background: rgba(0,0,0,0.9); }

        /* =========================================
           6. MODALES
           ========================================= */
        .modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 3000; 
            flex-direction: column; justify-content: center; align-items: center; 
            backdrop-filter: blur(5px); 
        }
        #modal-card-container { width: 340px; aspect-ratio: 2 / 3; margin-bottom: 20px; filter: drop-shadow(0 0 20px rgba(0,0,0,0.5)); }
        
        .btn-group { display: flex; gap: 15px; justify-content: center; width: 100%; }
        .btn-action { background-color: var(--color-acento); color: #000; border: none; font-weight: bold; }
        .btn-action:hover { opacity: 0.9; transform: scale(1.02); }

        /* =========================================
           7. ARMADOR DE EQUIPOS (INTERFAZ)
           ========================================= */
        #team-modal-content { 
            background: var(--color-paneles); padding: 20px; border-radius: 8px; border: 1px solid var(--color-bordes); 
            width: 90%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column; 
        }
        
        .team-title { text-align: center; color: var(--color-acento); margin-bottom: 5px; font-size: 2rem; }
        
        #team-counter { 
            text-align: center; color: #888; font-size: 1rem; margin-bottom: 15px; 
            border-bottom: 1px solid var(--color-bordes); padding-bottom: 10px; 
            font-family: var(--fuente-texto); font-weight: bold; text-transform: uppercase;
        }
        
        .team-scroll { 
            overflow-y: auto; flex: 1; margin-bottom: 15px; 
            border: 1px solid var(--color-bordes); padding: 10px; background: #111; 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px;
        }
        
        .player-row { 
            display: flex; align-items: center; gap: 12px; 
            padding: 10px; background: #252525; border-radius: 4px; cursor: pointer; 
            user-select: none; transition: opacity 0.2s;
            font-family: var(--fuente-texto); font-size: 1rem;
        }
        .player-row:hover { background: #333; }
        .player-row.disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        .player-check { transform: scale(1.3); accent-color: var(--color-acento); cursor: pointer; }
        
        /* BOT√ìN GENERAR (Estado Inactivo por defecto) */
        .btn-generate { 
            background: #333; color: #888; width: 100%; font-size: 1.5rem; margin-bottom: 15px; 
            border: 1px solid #444; pointer-events: none; transition: all 0.3s;
        }
        /* Estado Activo (Se agrega por JS) */
        .btn-generate.active { 
            background: var(--color-acento); color: #000; border-color: var(--color-acento); 
            pointer-events: auto; cursor: pointer; font-weight: bold;
        }
        .btn-generate.active:hover { transform: scale(1.02); }
        
        /* RESULTADOS */
        #team-capture-area { background: var(--color-paneles); padding: 10px; }
        .team-results { display: none; flex-direction: row; gap: 15px; margin-top: 5px; }
        
        .team-column { flex: 1; padding: 15px; border-radius: 8px; border: 2px solid var(--color-bordes); }
        .team-white { background: #e0e0e0; color: #111; border-color: #fff; }
        .team-black { background: #111; color: #fff; border-color: #333; }
        
        .team-header { font-size: 1.8rem; text-align: center; border-bottom: 2px solid; margin-bottom: 5px; font-weight: bold; font-family: var(--fuente-titulo);}
        .team-avg { text-align: center; font-size: 1rem; margin-bottom: 10px; opacity: 0.8; font-family: var(--fuente-texto); font-weight: bold; }
        
        .team-list-item { 
            padding: 6px 0; border-bottom: 1px solid rgba(128,128,128,0.3); 
            font-size: 1.1rem; font-family: var(--fuente-texto);
            display: flex; justify-content: space-between; align-items: center;
        }

        #loader { text-align: center; color: #666; margin-top: 50px; font-family: sans-serif;}
        body.retro-mode { filter: sepia(0.4) contrast(1.2) brightness(0.9); }
    </style>
</head>
<body>

    <div class="header-container" id="header-area" ondblclick="activarModoRetro()" title="Doble click para Modo Retro">
        <h1 id="default-title">PARTIDO DE LOS MARTES</h1>
    </div>
    
    <div class="controls-area">
        <input type="text" id="search-input" placeholder="Buscar jugador...">
        <select id="sort-select">
            <option value="nombre-asc">Nombre: A - Z</option>
            <option value="nombre-desc">Nombre: Z - A</option>
            <option value="prom-desc">Valoraci√≥n: Mayor a Menor</option>
            <option value="prom-asc">Valoraci√≥n: Menor a Mayor</option>
        </select>
        <button class="btn-standard" onclick="abrirArmador()">
            <span>‚öñÔ∏è</span> ARMAR EQUIPOS
        </button>
    </div>

    <div id="loader">Cargando jugadores...</div>
    <div id="grid-container" class="grid"></div>

    <div class="music-btn" onclick="toggleMusic()" title="Activar/Desactivar M√∫sica">
        <span id="music-icon">üîà</span>
    </div>
    <audio id="audio-player" loop></audio>

    <div id="modal" class="modal-overlay">
        <div id="modal-card-container"></div>
        <div class="btn-group">
            <button class="btn-standard" onclick="cerrarModal()">CERRAR</button>
            <button class="btn-standard btn-action" onclick="descargarCarta()">DESCARGAR</button>
        </div>
    </div>

    <div id="team-modal" class="modal-overlay">
        <div id="team-modal-content">
            <div class="team-title">SELECCIONAR JUGADORES</div>
            <div id="team-counter">Faltan 10 jugadores</div>
            <div id="players-checklist" class="team-scroll"></div>
            
            <button class="btn-generate" onclick="generarEquipos()" id="btn-generate">
                GENERAR EQUIPOS
            </button>
            
            <div id="team-capture-area">
                <div id="team-results" class="team-results">
                    <div class="team-column team-white" id="col-team-1">
                        <div class="team-header">CLARO</div>
                        <div class="team-avg" id="avg-team-1">Prom: 0</div>
                        <div id="list-team-1"></div>
                    </div>
                    <div class="team-column team-black" id="col-team-2">
                        <div class="team-header">OSCURO</div>
                        <div class="team-avg" id="avg-team-2">Prom: 0</div>
                        <div id="list-team-2"></div>
                    </div>
                </div>
            </div>

            <div class="btn-group" style="margin-top: 15px;">
                <button class="btn-standard" onclick="cerrarArmador()">CERRAR</button>
                <button class="btn-standard btn-action" onclick="descargarEquipos()" id="btn-download-teams" style="display:none;">DESCARGAR PARTIDO</button>
            </div>
        </div>
    </div>

<script>
    // ====================================================================
    //  ZONA DE CONFIGURACI√ìN
    // ====================================================================
    
    const FONDO_URL = "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Fondo.png"; 
    const TITULO_IMG_URL = "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Titulo.png";
    const MUSICA_URL = "https://raw.githubusercontent.com/nicolasfaravelli/partido-de-los-martes/main/Musica.mp3";

    // ====================================================================

    if(FONDO_URL) document.documentElement.style.setProperty('--fondo-url', `url('${FONDO_URL}')`);
    if(TITULO_IMG_URL) document.getElementById('header-area').innerHTML = `<img src="${TITULO_IMG_URL}" class="title-img" alt="Logo">`;
    if(MUSICA_URL) document.getElementById('audio-player').src = MUSICA_URL; else document.querySelector('.music-btn').style.display = 'none';

    const NEW_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTHOyW-OmPwPBpIwBw30sBjYdcLn1_8xFjkXfG9_tLFeB960jfYnnouTDieGPeKSK49FYM1tSGng_mg/pub?gid=1826229647&single=true&output=csv";
    const PROXY_URL = "https://corsproxy.io/?" + encodeURIComponent(NEW_CSV_URL);

    const COLORES = { 'oro': '#624f21', 'plata': '#434343', 'bronce': '#5e3e21', 'legendario': '#392266' };

    let datosOriginales = []; 
    let datosFiltrados = [];  

    // CARGA
    Papa.parse(PROXY_URL, {
        download: true, header: false, skipEmptyLines: true,
        complete: function(results) {
            const data = results.data;
            document.getElementById('loader').style.display = 'none';
            if(data.length > 0) data.shift(); 

            datosOriginales = data.map((fila, index) => {
                const nombre = fila[0]; 
                if(!nombre || nombre === 'Jugador') return null;
                
                let tipoCarta = fila[10] ? fila[10].trim().toLowerCase() : 'oro';
                let colorTexto = COLORES[tipoCarta] || '#624f21'; 

                return {
                    id: index,
                    nombre: nombre,
                    edad: parseInt(fila[1]) || 25, 
                    ata: parseInt(fila[2]) || 0, def: parseInt(fila[3]) || 0, tec: parseInt(fila[4]) || 0, 
                    vel: parseInt(fila[5]) || 0, res: parseInt(fila[6]) || 0, arq: parseInt(fila[7]) || 0,
                    prom: parseInt(fila[8]) || 0, pos: fila[9] ? fila[9].trim() : "",
                    fondo: fila[11] ? fila[11].trim() : "", foto: fila[12] ? fila[12].trim() : "",
                    color: colorTexto
                };
            }).filter(item => item !== null); 

            datosFiltrados = [...datosOriginales];
            aplicarFiltrosYOrden();
        }
    });

    // FILTROS
    const searchInput = document.getElementById('search-input');
    const sortSelect = document.getElementById('sort-select');
    searchInput.addEventListener('input', aplicarFiltrosYOrden);
    sortSelect.addEventListener('change', aplicarFiltrosYOrden);
    
    function aplicarFiltrosYOrden() {
        const textoBusqueda = searchInput.value.toLowerCase();
        const criterioFull = sortSelect.value.split('-'); 
        const criterio = criterioFull[0];
        const orden = criterioFull[1];

        datosFiltrados = datosOriginales.filter(j => j.nombre.toLowerCase().includes(textoBusqueda));

        datosFiltrados.sort((a, b) => {
            if (criterio === 'nombre' || criterio === 'pos') return orden === 'asc' ? a[criterio].localeCompare(b[criterio]) : b[criterio].localeCompare(a[criterio]);
            return orden === 'asc' ? a[criterio] - b[criterio] : b[criterio] - a[criterio];
        });
        renderizarGrilla(datosFiltrados);
    }

    function renderizarGrilla(lista) {
        const container = document.getElementById('grid-container');
        container.innerHTML = '';
        if(lista.length === 0) { container.innerHTML = '<p style="text-align:center; width:100%; color:#aaa;">No se encontraron jugadores.</p>'; return; }
        lista.forEach(jugadorObj => {
            const html = `<div class="card" onclick="abrirModalPorID(${jugadorObj.id})">${generarHTMLCarta(jugadorObj, true)}</div>`;
            container.innerHTML += html;
        });
    }

    function generarHTMLCarta(j, lazy = false) {
        const loadingAttr = lazy ? 'loading="lazy"' : '';
        const fotoHtml = j.foto ? `<img src="${j.foto}" class="card-face" ${loadingAttr} crossorigin="anonymous">` : '';
        return `
            <div class="card-bg-wrapper"><img src="${j.fondo}" class="card-bg" ${loadingAttr} referrerpolicy="no-referrer" crossorigin="anonymous"></div>
            <div class="shine-layer" style="-webkit-mask-image: url('${j.fondo}'); mask-image: url('${j.fondo}');"></div>
            ${fotoHtml}
            <div class="info-layer">
                <div class="rating" style="color: ${j.color}">${j.prom}</div>
                <div class="position" style="color: ${j.color}">${j.pos}</div>
                <div class="name" style="color: ${j.color}">${j.nombre}</div>
                <div class="stats-container" style="color: ${j.color}">
                    <div class="stat-box"><span class="stat-val">${j.ata}</span></div>
                    <div class="stat-box"><span class="stat-val">${j.def}</span></div>
                    <div class="stat-box"><span class="stat-val">${j.tec}</span></div>
                    <div class="stat-box"><span class="stat-val">${j.vel}</span></div>
                    <div class="stat-box"><span class="stat-val">${j.res}</span></div>
                    <div class="stat-box"><span class="stat-val">${j.arq}</span></div>
                </div>
            </div>
        `;
    }

    // MODAL
    function abrirModalPorID(idReal) {
        const jugador = datosOriginales.find(j => j.id === idReal);
        if(!jugador) return;
        document.getElementById('modal-card-container').innerHTML = `<div class="card" id="carta-para-descargar">${generarHTMLCarta(jugador, false)}</div>`;
        document.getElementById('modal').style.display = 'flex';
    }
    function cerrarModal() { document.getElementById('modal').style.display = 'none'; }
    function descargarCarta() {
        const elemento = document.getElementById('carta-para-descargar');
        const btn = document.querySelector('.btn-download');
        btn.innerText = "PROCESANDO...";
        const shine = elemento.querySelector('.shine-layer');
        if(shine) shine.style.display = 'none';
        html2canvas(elemento, { useCORS: true, allowTaint: true, backgroundColor: null, scale: 3 }).then(canvas => {
            const link = document.createElement('a'); link.download = `FUT_Carta_${Date.now()}.png`; link.href = canvas.toDataURL("image/png"); link.click();
            btn.innerText = "DESCARGAR"; if(shine) shine.style.display = 'block';
        }).catch(err => { alert("Error: " + err); btn.innerText = "ERROR"; if(shine) shine.style.display = 'block'; });
    }
    document.addEventListener('keydown', function(event) { if (event.key === "Escape") { cerrarModal(); cerrarArmador(); } });

    // M√öSICA
    const audioPlayer = document.getElementById('audio-player');
    const musicBtn = document.querySelector('.music-btn');
    const musicIcon = document.getElementById('music-icon');
    let isPlaying = false;
    function toggleMusic() {
        if(!audioPlayer.src) return; 
        if (isPlaying) { audioPlayer.pause(); musicIcon.innerText = "üîà"; musicBtn.classList.remove('playing'); isPlaying = false; }
        else { audioPlayer.volume = 0.05; audioPlayer.play().then(() => { musicIcon.innerText = "üîä"; musicBtn.classList.add('playing'); isPlaying = true; }).catch(e => console.log("Bloqueo audio", e)); }
    }
    function activarModoRetro() { document.body.classList.toggle('retro-mode'); }

    // =======================================================
    //  ARMADOR DE EQUIPOS (V3: Bot√≥n Activo + Visual)
    // =======================================================
    
    function abrirArmador() {
        const list = document.getElementById('players-checklist');
        list.innerHTML = '';
        const sorted = [...datosOriginales].sort((a,b) => a.nombre.localeCompare(b.nombre));
        
        sorted.forEach(j => {
            list.innerHTML += `
            <label class="player-row" id="row-${j.id}">
                <input type="checkbox" class="player-check" value="${j.id}" onclick="controlarLimite(this)">
                <span>${j.nombre}</span>
            </label>`;
        });
        
        document.getElementById('team-results').style.display = 'none';
        document.getElementById('btn-download-teams').style.display = 'none';
        document.getElementById('team-modal').style.display = 'flex';
        actualizarContador(0);
    }

    function cerrarArmador() { document.getElementById('team-modal').style.display = 'none'; }

    function controlarLimite(checkbox) {
        const checked = document.querySelectorAll('.player-check:checked');
        const count = checked.length;
        actualizarContador(count);
        if (count >= 10) {
            document.querySelectorAll('.player-check:not(:checked)').forEach(cb => {
                cb.disabled = true; document.getElementById(`row-${cb.value}`).classList.add('disabled');
            });
        } else {
            document.querySelectorAll('.player-check').forEach(cb => {
                cb.disabled = false; document.getElementById(`row-${cb.value}`).classList.remove('disabled');
            });
        }
    }

    function actualizarContador(count) {
        const missing = 10 - count;
        const counterLabel = document.getElementById('team-counter');
        const generateBtn = document.getElementById('btn-generate');
        if (missing > 0) {
            counterLabel.innerText = `FALTAN ${missing} JUGADORES`; counterLabel.style.color = "#888"; 
            generateBtn.classList.remove('active'); // Bot√≥n gris
        } else if (missing === 0) {
            counterLabel.innerText = "¬°LISTO! (10/10)"; counterLabel.style.color = "var(--color-acento)"; 
            generateBtn.classList.add('active'); // Bot√≥n Dorado
        } else {
            counterLabel.innerText = "DEMASIADOS JUGADORES";
        }
    }

    // HELPER: COLOR POR PROMEDIO
    function getRatingColor(val) {
        if (val >= 90) return 'var(--stat-legend)'; // Violeta
        if (val >= 80) return 'var(--stat-gold)';   // Dorado
        if (val >= 70) return 'var(--stat-silver)'; // Plata
        return 'var(--stat-bronze)';                // Bronce
    }

    // HELPER: RENDER LIST ITEM
    function getPlayerHTML(p, isWhite) {
        const colorNota = getRatingColor(p.prom);
        const emoji = isWhite ? '‚ö™' : '‚ö´';
        return `
        <div class="team-list-item">
            <span>${emoji} ${p.nombre}</span>
            <strong style="color:${colorNota}">${p.prom}</strong>
        </div>`;
    }

    function generarEquipos() {
        const checkboxes = document.querySelectorAll('.player-check:checked');
        const selectedIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
        
        let pool = datosOriginales.filter(j => selectedIds.includes(j.id));
        let teamA = []; let teamB = []; let scoreA = 0; let scoreB = 0;

        pool.sort((a, b) => b.arq - a.arq);
        let portero1 = pool[0];
        let portero2 = pool[1];
        let resto = pool.slice(2);

        teamA.push(portero1); scoreA += getImpactScore(portero1);
        teamB.push(portero2); scoreB += getImpactScore(portero2);

        resto.sort((a, b) => {
            let impactA = getImpactScore(a) + (Math.random() * 4 - 2); // +/- 2 de caos
            let impactB = getImpactScore(b) + (Math.random() * 4 - 2);
            return impactB - impactA;
        });

        resto.forEach(p => {
            let impact = getImpactScore(p);
            if (scoreA <= scoreB) { teamA.push(p); scoreA += impact; } 
            else { teamB.push(p); scoreB += impact; }
        });

        let finalTeam1, finalTeam2;
        if (Math.random() > 0.5) {
            finalTeam1 = { data: teamA, prom: calcularPromedioReal(teamA) };
            finalTeam2 = { data: teamB, prom: calcularPromedioReal(teamB) };
        } else {
            finalTeam1 = { data: teamB, prom: calcularPromedioReal(teamB) };
            finalTeam2 = { data: teamA, prom: calcularPromedioReal(teamA) };
        }

        finalTeam1.data.sort((a,b) => a.nombre.localeCompare(b.nombre));
        finalTeam2.data.sort((a,b) => a.nombre.localeCompare(b.nombre));

        // RENDER CON COLORES Y EMOJIS
        document.getElementById('list-team-1').innerHTML = finalTeam1.data.map(p => getPlayerHTML(p, true)).join('');
        document.getElementById('avg-team-1').innerText = `Prom: ${finalTeam1.prom}`;

        document.getElementById('list-team-2').innerHTML = finalTeam2.data.map(p => getPlayerHTML(p, false)).join('');
        document.getElementById('avg-team-2').innerText = `Prom: ${finalTeam2.prom}`;

        document.getElementById('team-results').style.display = 'flex';
        document.getElementById('btn-download-teams').style.display = 'block';
    }

    function getImpactScore(p) { return (p.prom * 6) + (p.res * 3) + (p.tec * 2) - (p.edad * 0.5); }
    function calcularPromedioReal(equipo) { let sum = 0; equipo.forEach(p => sum += p.prom); return (sum / equipo.length).toFixed(1); }
    function descargarEquipos() {
        const elemento = document.getElementById('team-capture-area');
        html2canvas(elemento, { backgroundColor: '#1a1a1a', scale: 2 }).then(canvas => {
            const link = document.createElement('a'); link.download = `PARTIDO_${Date.now()}.png`; link.href = canvas.toDataURL("image/png"); link.click();
        });
    }
</script>

</body>
</html>
